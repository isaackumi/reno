# Reno

<div style="margin: 0 auto; max-width: 400px;">
  <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   id="svg8"
   version="1.1"
   viewBox="0 0 295 175.69719"
   height="175.69719mm"
   width="295mm">
  <defs
     id="defs2" />
  <metadata
     id="metadata5">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title></dc:title>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     transform="translate(129.21604,-67.747318)"
     id="layer1">
    <g
       style="fill:#000000"
       transform="matrix(-0.99353443,0,0,0.99353703,-160.97462,28.405335)"
       id="g181">
      <g
         style="fill:#000000;stroke:none"
         transform="matrix(0.03527778,0,0,-0.03527778,-164.15584,289.84044)"
         id="g117">
        <path
           id="path105"
           d="m 1516.9903,7007.3523 c -193.3848,4.0876 -572.81098,-65.5561 -803.63085,-147.318 -205.58142,-87.0216 -435.83542,-189.0368 -579.8576,-287.4246 -157.923504,-102.7647 -309.02304,-248.0238 -432.25284,-387.3178 -126.84253,-152.866 -185.16833,-336.095 -180.00446,-534.3322 -2.43395,-156.1066 31.19655,-328.8633 177.05751,-409.8008 143.86638,-122.9881 311.0241062,-221.2543 503.92422,-243.2841 243.42523,-61.9083 497.34243,-67.1116 746.6683,-67.6521 190.66482,42.6547 392.00682,40.1383 562.91072,95.9803 185.8653,5.1651 225.4889,-520.5937 194.5231,-365.7598 35.0468,-252.2354 11.8761,-510.0023 77.4986,-760.4824 -3.0158,-519.125 -13.8374,-1037.7957 -35.7842,-1556.337 -1.4743,-179.1035 -39.8006,-180.8973 152.1533,-151.5269 321.518,8.7069 655.6862,-84.3721 964.6523,42.7568 241.5091,43.8797 464.0885,163.0481 700.4863,231.5857 167.7192,33.9642 104.049,89.8725 95.2676,219.2169 32.006,152.0551 -25.8525,1176.0012 52.771,531.3584 20.298,-199.0295 29.6507,-401.9276 33.6516,-608.914 4.4538,-525.7446 -126.4178,-526.7675 -446.6209,-527.4018 -336.9923,2.6795 -315.2697,0.738 -666.0606,1.2276 -473.6166,0 -523.5431,-1.1758 -865.3415,1.6487 -198.0418,-0.038 -98.0754,382.3407 -88.9285,605.94 14.3822,411.2452 24.4277,823.9321 18.9051,1235.0134 -24.8606,338.4224 -31.7855,492.3641 -66.4,737.6953 -11.8377,104.9645 -63.2579,254.8103 -78.4425,295.4981 -215.5952,-49.5141 -350.7505,-85.9702 -624.15457,-110.9137 -430.48533,-8.5375 -692.3471,23.6451 -1013.249861,150.9767 -97.372939,44.3487 -203.136029,119.0309 -308.003759,212.7666 -172.82396,129.1331 -182.39845,385.4426 -157.79073,584.9654 33.82351,228.3826 146.62089,418.5662 300.24262,572.8149 212.227658,191.1502 416.64298,329.2747 663.88923,453.2522 198.53759,102.1813 416.50549,165.2974 632.70767,214.7226 700.6386,144.465 588.0802,-36.936 469.2137,-28.9544 z"
           style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:37.49999619;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none" />
        <path
           id="path113"
           d="m 1451.0246,7093.4888 c 229.2042,-0.5854 425.1444,-47.4425 672.6529,-103.5377 201.5507,-59.0821 370.7823,-153.2169 541.3558,-300.289 130.774,-126.1143 298.3965,-284.9673 396.5718,-415.3737 92.7876,-135.8328 163.4186,-260.7981 192.0155,-306.1604 95.1273,-207.4158 189.3903,-410.3386 231.6298,-657.2601 33.1954,-216.2199 73.8693,-418.5366 118.9429,-640.2258 44.0268,-324.246 71.2839,-652.585 98.35,-975.1392 9.8957,-184.8107 19.8549,-381.6114 16.6997,-572.6665 -8.0882,-140.7079 -39.3855,351.785 -90.784,477.2507 -10.8447,229.8577 -13.5507,459.0258 -48.9227,686.648 -29.6609,238.0189 -84.5184,471.5476 -117.2802,708.0134 -25.9898,194.2077 -29.4292,388.8594 -97.6649,570.1529 -59.5145,124.1095 -253.6264,482.22 -199.8098,395.2317 -83.9113,91.2909 -150.1898,283.1919 -255.9828,394.4765 -147.2701,158.2396 -307.6559,293.3578 -472.7391,426.5887 -182.7534,119.354 -409.2002,144.9527 -617.2593,203.698 -116.4759,13.6137 -531.1771,19.7032 -367.7756,108.5925 z"
           style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:37.49999619;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none" />
      </g>
      <path
         id="path170"
         d="m -111.13664,42.314707 c -7.11807,0.216585 -14.16716,1.514028 -21.0709,3.202284 -5.13589,1.190545 -9.97957,3.307514 -14.75074,5.502682 -6.40106,2.871123 -12.68515,6.176928 -18.05405,10.746983 -3.41382,2.9106 -6.65443,6.043107 -9.61935,9.411333 -4.2522,4.897151 -6.67084,11.334678 -6.66782,17.820912 -0.10934,4.304448 0.13855,8.920279 2.56664,12.632149 1.47662,2.37512 4.05791,3.64616 6.11922,5.4211 4.44511,3.36593 9.63797,5.90952 15.1727,6.74435 6.22037,1.44552 12.5921,2.1139 18.96895,2.29375 2.77474,0.0236 5.56975,0.32237 8.33442,0.0101 6.36035,-1.29015 13.00795,-1.42075 19.23583,-3.21183 1.86564,-0.18825 3.19996,1.50199 4.05472,2.94309 1.74376,3.14126 2.56475,6.71079 2.91021,10.26482 -0.28469,1.34915 0.15901,2.75033 0.14961,4.1179 0.47378,6.27763 0.45978,12.62486 1.546,18.84501 0.28924,1.67692 0.95386,3.29929 0.72499,5.02742 -0.18935,17.88986 -0.54378,35.77751 -1.29123,53.65243 0.0139,1.50844 -0.22604,3.05208 -0.009,4.54306 0.34455,0.99194 1.48618,1.1091 2.37635,0.94462 2.243988,-0.21515 4.490199,-0.60663 6.747511,-0.39465 4.663135,0.13042 9.307494,0.6194 13.970936,0.78736 4.859369,0.0377 9.821471,0.0128 14.482773,-1.54525 3.750186,-1.22912 7.667591,-1.94423 11.370971,-3.37503 5.798003,-2.02649 11.450664,-4.50174 17.387282,-6.07895 1.231458,-0.36903 2.524575,-1.34204 2.387412,-2.77501 -0.09258,-2.00356 -0.771861,-3.97693 -0.497737,-5.99242 0.40677,-6.62357 0.157755,-13.26615 0.193516,-19.89771 -0.09207,-2.36648 0.23799,-4.77625 -0.415671,-7.08621 -0.37987,-2.00055 -1.133207,-3.93539 -1.098531,-5.99986 -0.36132,-8.11042 -0.644226,-16.26521 -1.943529,-24.30074 -1.476145,-9.95011 -3.737898,-19.77228 -4.638704,-29.79972 -0.609507,-5.50173 -1.326126,-11.174907 -4.080684,-16.082661 -2.642309,-5.086336 -5.205701,-10.229416 -8.277315,-15.074259 -2.311704,-3.821226 -4.157983,-8.046294 -7.479025,-11.140752 -4.998632,-5.120391 -10.327507,-9.941534 -16.064552,-14.223611 -4.351235,-2.933901 -9.575679,-4.10265 -14.590676,-5.371267 -3.489745,-0.820478 -6.94622,-1.932609 -10.558917,-2.043115 -2.52922,-0.143348 -5.05288,-0.546094 -7.592,-0.518268 z"
         style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.66817379;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none" />
    </g>
    <path
       d="m 1.06762,90.888026 c 3.6451682,1.57724 3.9255637,6.519262 0.490708,8.271752 -2.48853207,1.261792 -5.0121161,0.665938 -6.3089603,-1.507146 -2.4534799,-3.995678 1.5421981,-8.622242 5.8182523,-6.764606 z"
       id="path79"
       style="fill:#ffffff;stroke:none;stroke-width:0.03504972" />
    <path
       d="m -19.964824,93.522567 c 3.364782,2.067938 3.364782,7.045003 0,9.112933 -3.32972,1.99784 -7.640826,-0.63089 -7.640826,-4.626567 0,-3.85547 4.416252,-6.449158 7.640826,-4.486366 z"
       id="path81"
       style="fill:#ffffff;stroke:none;stroke-width:0.03504972" />
    <text
       id="text53"
       y="240.42036"
       x="-50.900177"
       style="font-style:normal;font-weight:normal;font-size:26.95657349px;line-height:125%;font-family:Sans;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.67391437px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       xml:space="preserve"><tspan
         style="stroke-width:0.67391437px"
         id="tspan51"
         y="240.42036"
         x="-50.900177"><tspan
           id="tspan49"
           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:129.39155579px;font-family:'Nimbus Sans L';-inkscape-font-specification:'Nimbus Sans L Bold';letter-spacing:-4.03247786px;word-spacing:0px;stroke-width:0.67391437px"
           y="240.42036"
           x="-50.900177">eno</tspan></tspan></text>
    <flowRoot
       transform="matrix(0.26287334,0,0,0.26287334,-0.83511972,1.5733751)"
       style="font-style:normal;font-weight:normal;font-size:40px;line-height:125%;font-family:Sans;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       id="flowRoot191"
       xml:space="preserve"><flowRegion
         id="flowRegion193"><rect
           y="575.01703"
           x="1018.2338"
           height="45.456863"
           width="31.31473"
           id="rect195" /></flowRegion><flowPara
         id="flowPara197" /></flowRoot>  </g>
</svg>

</div>

Reno is a thin routing library designed to sit on top of [Deno](https://deno.land/)'s [standard HTTP module](https://github.com/denoland/deno_std/tree/master/http).

```tsx
import { serve } from "https://deno.land/std@v0.23.0/http/server.ts";

import {
  createRouter,
  AugmentedRequest,
  createRouteMap,
  textResponse,
  jsonResponse,
  streamResponse,
} from "https://raw.githubusercontent.com/reno-router/reno/v0.6.4/reno/mod.ts";

export const routes = createRouteMap([
  ["/home", () => textResponse("Hello world!")],

  // Supports RegExp routes for further granularity
  [/^\/api\/swanson\/?([0-9]?)$/, async (req: AugmentedRequest) => {
    const [quotesCount = "1"] = req.routeParams;

    const res = await fetch(
      `https://ron-swanson-quotes.herokuapp.com/v2/quotes/${quotesCount}`,
    );

    return jsonResponse(await res.json());
  }],

  // Supports Reader for streaming responses in chunks
  ["/streamed-response", () => streamResponse(
    new ReactReader(<App />),
  )],
]);

const router = createRouter(routes);

(async () => {
  console.log("Listening for requests...");

  for await (const req of serve(":8001")) {
    req.respond(await router(req));
  }
})();
```

**TODO: replace/complement this with proper documentation**

## Responses are just Data Structures

This, along with request handlers being [pure functions](https://en.wikipedia.org/wiki/Pure_function), makes unit testing Reno services a breeze:

```ts
import { jsonResponse, assertResponsesMatch } from "https://raw.githubusercontent.com/reno-router/reno/v0.6.4/reno/mod.ts";
import { createRonSwansonQuoteHandler } from "./routes.ts";

const createFetchStub = (response: string[]) =>
  sinon.stub().resolves({
    json: sinon.stub().resolves(response),
  });

test({
  name: "ronSwansonQuoteHandler should fetch a quote from an API and return it",
  async fn() {
    const quotes = ["Some Ron Swanson Quote"];
    const fetchStub = createFetchStub(quotes);
    const ronSwansonQuoteHandler = createRonSwansonQuoteHandler(fetchStub);

    const req = {
      routeParams: []
    };

    const response = await ronSwansonQuoteHandler(req);

    assertResponsesMatch(response, jsonResponse(quotes, {
      "X-Foo": "bar"
    }));
  }
});
```

## `pipe()` - An Alternative to Middleware

Deno emulates the middleware pattern, [found in Express](https://expressjs.com/en/guide/using-middleware.html), favouring [function piping](https://www.sitepoint.com/function-composition-in-javascript/#theimportanceofinvocationorder) to create reusable, higher-order route handlers:

```ts
import { createRouteMap, jsonResponse, pipe } from "https://raw.githubusercontent.com/reno-router/reno/v0.6.4/reno/mod.ts";

const withCaching = pipe(
  (req, res) => {
    /* Mutate the response returned by
     * the inner route handler... */
    res.headers.append("Cache-Control", "max-age=86400");
  },

  /* ...or go FP and return a new
   * response reference entirely. */
  (req, res) => ({
    ...res,
    cookies: new Map<string, string>([["requested_proto", req.proto]])
  })
);

const home = withCaching(() =>
  jsonResponse({
    foo: "bar",
    isLol: true
  })
);

export const routes = createRouteMap([["/", home]]);
```

## Local Development

Once you've cloned the repository, you'll need to ensure you're running the version of Deno against which this project is developed; this is stored in `.deno-version`. To install the correct version, run:

```sh
$ curl -fsSL https://deno.land/x/install/install.sh | sh -s $(cat .deno-version)
```

You should also run `./tools/install-types.sh` to install the TypeScript definitions for Deno and any other third-party dependencies.

Then you can run:

* `deno example/index.ts` - starts the example server
* `deno test` - runs the unit tests

## Functionality Checklist

* [x] Path routing
* [x] Async-compatible route handlers
* [x] Error handling
* [x] Route params
* [x] Query params
* [x] Response helpers
* [x] JSON
* [x] Custom headers
* [x] Request bodies
* [x] Cookies
* [x] Streaming responses with [`Reader`](https://deno.land/typedoc/interfaces/_deno_.reader.html)
* [ ] Streaming request bodies

